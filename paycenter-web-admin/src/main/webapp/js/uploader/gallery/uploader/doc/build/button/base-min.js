/*!build time : 2014-08-12 11:32:33 AM*/
KISSY.add("kg/uploader/2.0.2/button/base",function(a,b,c){function d(b,c){var e=this;c=a.merge({target:g(b)},c),d.superclass.constructor.call(e,c)}var e="",f="[Uploader-Button] ",g=b.all;return a.mix(d,{event:{beforeShow:"beforeShow",afterShow:"afterShow",beforeHide:"beforeHide",afterHide:"afterHide",beforeRender:"beforeRender",afterRender:"afterRender",CHANGE:"change"},getFileName:function(a){return a.replace(/.*(\/|\\)/,"")}}),a.extend(d,c,{render:function(){var b=this,c=b.get("srcFileInput");if(!c||!c.length)return a.log("[Button]file\u5143\u7d20\u4e0d\u5b58\u5728\uff01"),b;var d=c.clone();d.addClass("file-input"),c.remove(),b.set("srcFileInput",d),b._createInput()},show:function(){var a=this,b=a.get("target");return b.show(),a.fire(d.event.afterShow),d},hide:function(){var a=this,b=a.get("target");return b.hide(),a.fire(d.event.afterHide),d},reset:function(){var a=this,b=a.get("inputContainer");return g(b).remove(),a.set("inputContainer",e),a.set("fileInput",e),a._createInput(),a},_createInput:function(){var b=this,c=b.get("target"),d=(b.get("name"),b.get("tpl"));if(!a.isString(d))return!1;var e=b.get("srcFileInput");if(!e.length)return!1;var f=e.clone();b.set("fileInput",f);var h=g(d);return h.append(f),h.appendTo(c),6==a.UA.ie&&f.css("fontSize","400px"),g(f).on("change",b._changeHandler,b),b.set("inputContainer",h),b._setDisabled(b.get("disabled")),b._setMultiple(b.get("multiple")),h},_changeHandler:function(b){var c=this,h=c.get("fileInput"),i=g(h).val(),j=b.target.files,k=[];return i==e?(a.log(f+"No file selected."),!1):(j?a.each(j,function(b){a.isObject(b)&&k.push({name:b.name,type:b.type,size:b.size,data:b})}):k.push({name:d.getFileName(i)}),c.fire(d.event.CHANGE,{files:k,input:h.getDOMNode()}),void c.reset())},_setDisabled:function(b){var c=this,d=c.get("cls"),e=d.disabled,f=c.get("target"),h=c.get("fileInput");return f.length&&a.isBoolean(b)?(b?(f.addClass(e),g(h).hide()):(f.removeClass(e),g(h).show()),b):!1},_setMultiple:function(a){var b=this,c=b.get("fileInput");return c.length?(a&&c.attr("multiple","multiple")||c.removeAttr("multiple"),a):!1}},{ATTRS:{target:{value:null},fileInput:{value:e},srcFileInput:{value:e},inputContainer:{value:e},tpl:{value:'<div class="file-input-wrapper" style="overflow: hidden;"></div>'},name:{value:"fileInput",setter:function(a){return this.get("fileInput")&&g(this.get("fileInput")).attr("name",a),a}},disabled:{value:!1,setter:function(a){return this._setDisabled(a),a}},multiple:{value:!0,setter:function(a){return this._setMultiple(a),a}},cls:{value:{disabled:"uploader-button-disabled"}}}}),d},{requires:["node","base"]});